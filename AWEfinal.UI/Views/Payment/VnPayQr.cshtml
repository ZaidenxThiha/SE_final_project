@model AWEfinal.DAL.Models.Order
@{
    ViewData["Title"] = "VNPay QR Payment";
    var paymentUrl = ViewBag.PaymentUrl as string ?? "";
}

<div class="card shadow-sm border-0">
    <div class="card-body">
        <h3 class="mb-3">Pay with VNPay</h3>
        @if (Model != null)
        {
            <p class="text-muted mb-4">Scan the QR code below to pay for order <strong>@Model.OrderNumber</strong>. Total: <strong>@Model.Total.ToString("N0") VND</strong></p>
        }

        @if (!string.IsNullOrWhiteSpace(ViewBag.Error as string))
        {
            <div class="alert alert-danger">@ViewBag.Error</div>
        }
        else if (string.IsNullOrWhiteSpace(paymentUrl))
        {
            <div class="alert alert-danger">Could not generate VNPay link. Please check VNPay configuration.</div>
        }
        else
        {
            <div class="d-flex flex-wrap align-items-center gap-4">
                <div class="p-3 border rounded bg-light">
                    <img src="https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=@Uri.EscapeDataString(paymentUrl)" alt="VNPay QR" />
                </div>
                <div class="flex-grow-1">
                    <div class="mb-3">
                        <label class="form-label">Payment URL</label>
                        <input type="text" class="form-control" readonly value="@paymentUrl" />
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <a class="btn btn-success" href="@paymentUrl" target="_blank" rel="noreferrer">
                            <i class="bi bi-box-arrow-up-right"></i> Open VNPay
                        </a>
                        @if (Model != null)
                        {
                            <a class="btn btn-outline-secondary" href="@Url.Action("OrderConfirmation", "Cart", new { id = Model.Id })">
                                Back to Order
                            </a>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>
