@model List<AWEfinal.DAL.Models.Product>
@using System.Text.Json
@using System.Linq
@{
    ViewData["Title"] = "Home";
    var heroImage = "https://images.unsplash.com/photo-1582018960590-f3bc3ea25c04?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&q=80&w=1080";
    var featuredPills = new[] { "Smartphones", "Laptops", "Smart TVs", "Headphones", "Gaming Consoles" };
    var previewColors = new[] { "#E8D5E8", "#C5D9E8", "#E8E8E8", "#D5E8D5" };
    var isAdmin = Context.Session.GetString("UserRole") == "admin";
}


<section class="awe-max-container awe-section">
    <div class="awe-section__header">
        <div>
            <h2 class="awe-section__title">Popular right now</h2>
        </div>
        <a class="awe-btn awe-btn--ghost" asp-controller="Product" asp-action="Index">View all products</a>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="awe-empty-state">
            <h3>We're stocking the shelves</h3>
            <p class="awe-tagline">No products are live right now. Check back soon or ping your admin to seed inventory.</p>
            @if (isAdmin)
            {
                <a class="awe-btn awe-btn--primary mt-3" asp-controller="Admin" asp-action="Products">Go to product manager</a>
            }
            else
            {
                <a class="awe-btn awe-btn--primary mt-3" asp-controller="Product" asp-action="Index">Browse catalog</a>
            }
        </div>
    }
    else
    {
        <div class="awe-product-grid">
            @foreach (var product in Model.Take(8))
            {
                var productImages = new List<string>();
                if (!string.IsNullOrEmpty(product.Images))
                {
                    try
                    {
                        productImages = JsonSerializer.Deserialize<List<string>>(product.Images) ?? new List<string>();
                    }
                    catch
                    {
                        productImages = new List<string>();
                    }
                }

                var productImage = productImages.FirstOrDefault() ?? "/images/products/placeholder.jpg";
                var inventoryCopy = product.InStock && product.StockQuantity > 0
                    ? $"{product.StockQuantity} left in stock"
                    : "Currently unavailable";

                <div class="awe-product-card">
                    <div class="awe-product-card__media">
                        <div class="awe-product-card__image">
                            <img src="@productImage"
                                 alt="@product.Name"
                                 loading="lazy"
                                 onerror="this.src='/images/products/placeholder.jpg';" />
                        </div>
                        <div class="awe-product-card__preview">
                            @foreach (var color in previewColors)
                            {
                                <span style="background-color: @color;"></span>
                            }
                        </div>
                    </div>

                    <div class="awe-product-card__info">
                        <div class="awe-product-card__meta">
                            <div class="awe-product-card__name">@product.Name</div>
                            <div class="awe-product-card__category">@product.Category</div>
                        </div>
                        <a class="awe-product-card__add" asp-controller="Cart" asp-action="AddToCart" asp-route-productId="@product.Id" title="Add to cart">
                            <i class="bi bi-plus-lg"></i>
                        </a>
                    </div>

                        <div class="awe-product-card__price">$@product.Price.ToString("N2")</div>
                    <div class="awe-tagline">@inventoryCopy</div>

                    <div class="awe-product-card__actions">
                        <a class="awe-btn awe-btn--primary" asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">
                            View details
                        </a>
                        @if (product.InStock && product.StockQuantity > 0)
                        {
                            <a class="awe-btn awe-btn--light" asp-controller="Cart" asp-action="AddToCart" asp-route-productId="@product.Id">
                                Add to cart
                            </a>
                        }
                        else
                        {
                            <span class="awe-btn awe-btn--light is-disabled">Out of stock</span>
                        }
                    </div>
                </div>
            }
        </div>
    }
</section>
