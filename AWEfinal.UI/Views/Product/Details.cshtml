@model AWEfinal.DAL.Models.Product
@using System.Text.Json
@{
    ViewData["Title"] = "Product Details";
    var productImages = new List<string>();
    if (!string.IsNullOrEmpty(Model.Images))
    {
        try
        {
            productImages = JsonSerializer.Deserialize<List<string>>(Model.Images) ?? new List<string>();
        }
        catch
        {
            productImages = new List<string>();
        }
    }
    var defaultImage = "/images/products/placeholder.jpg";
    var mainImage = productImages.Any() ? productImages.First() : defaultImage;
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            @if (productImages.Any())
            {
                <div id="productImageCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        @for (int i = 0; i < productImages.Count; i++)
                        {
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@productImages[i]" class="d-block w-100" alt="@Model.Name" style="max-height: 500px; object-fit: contain;">
                            </div>
                        }
                    </div>
                    @if (productImages.Count > 1)
                    {
                        <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    }
                </div>
                @if (productImages.Count > 1)
                {
                    <div class="d-flex gap-2 mb-3">
                        @foreach (var img in productImages)
                        {
                            <img src="@img" alt="Thumbnail" class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;" onclick="document.querySelector('#productImageCarousel .carousel-item.active img').src = this.src;" />
                        }
                    </div>
                }
            }
            else
            {
                <div class="bg-light d-flex align-items-center justify-content-center mb-4" style="height: 400px;">
                    <p class="text-muted">No image available</p>
                </div>
            }
        </div>
        <div class="col-md-6">
            <h2>@Model.Name</h2>
            <hr />
            <p><strong>Category:</strong> <span class="badge bg-secondary">@Model.Category</span></p>
            <p><strong class="fs-4 text-primary">Price: $@Model.Price.ToString("N2")</strong></p>
            <p><strong>Description:</strong></p>
            <p>@Model.Description</p>
            
            @if (!string.IsNullOrEmpty(Model.Storage))
            {
                <p><strong>Storage:</strong> @Model.Storage</p>
            }
            
            <p><strong>Rating:</strong> 
                @for (int i = 0; i < 5; i++)
                {
                    if (i < (int)Model.Rating)
                    {
                        <span class="text-warning">★</span>
                    }
                    else
                    {
                        <span class="text-muted">☆</span>
                    }
                }
                (@Model.Rating / 5.0)
            </p>
            
            <p><strong>In Stock:</strong> 
                @if (Model.InStock && Model.StockQuantity > 0)
                {
                    <span class="badge bg-success">Yes (@Model.StockQuantity units left)</span>
                }
                else
                {
                    <span class="badge bg-danger">No</span>
                }
            </p>
            
            <div class="mt-4">
                @if (Model.InStock && Model.StockQuantity > 0)
                {
                    <a href="@Url.Action("AddToCart", "Cart", new { productId = Model.Id })" class="btn btn-success btn-lg me-2">Add to Cart</a>
                }
                else
                {
                    <button class="btn btn-secondary btn-lg me-2" disabled>Out of Stock</button>
                }
                <a href="@Url.Action("Index", "Product")" class="btn btn-outline-secondary btn-lg">Back to Products</a>
            </div>
        </div>
    </div>
</div>

